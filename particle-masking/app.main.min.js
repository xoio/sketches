!function(t){var e={};function r(a){if(e[a])return e[a].exports;var n=e[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=e,r.d=function(t,e,a){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(a,n,function(e){return t[e]}.bind(null,n));return a},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=5)}([function(t,e){t.exports="\r\n\r\n/**\r\nTransform feedback simulation for moving particle system across the screen\r\n*/\r\n\r\nin vec4 position;\r\nin vec3 velocity;\r\nin vec3 origin;\r\n\r\nout vec4 oPos;\r\nout vec3 oVel;\r\nvoid main(){\r\n    oPos = position;\r\n    oVel = velocity;\r\n\r\n    // alpha holds life , when less than 0, reset ps\r\n    if(oPos.a < 0.0){\r\n        oPos.a = 1.0;\r\n        oPos.xyz = origin.xyz;\r\n    }else {\r\n\r\n        vec3 curl = curlNoise( oPos.xyz * 0.1 );\r\n        oVel += curl * 0.01;\r\n        oVel *= 0.97;\r\n        oVel.z += 0.002;\r\n\r\n        oPos.xyz += oVel;\r\n        oPos.a -= 0.0005;\r\n    }\r\n\r\n}"},function(t,e){t.exports="\r\nuniform mat4 projectionMatrix;\r\nuniform mat4 modelViewMatrix;\r\nuniform float time;\r\nin vec3 position;\r\nin vec4 iPosition;\r\nin float iScale;\r\nout float vAlpha;\r\nvoid main(){\r\n\r\n    gl_PointSize = 5.0;\r\n\r\n    vec3 pos = position;\r\n    pos.x *= iScale;\r\n    pos.y *= iScale;\r\n    pos.z *= iScale;\r\n\r\n    vec3 rotPos = rotateX(pos,time * iScale * 0.5);\r\n    rotPos = rotateY(rotPos,time * iScale * 0.5);\r\n    rotPos = rotateZ(rotPos,time * iScale * 0.5);\r\n\r\n    //vec4 pos = vec4(position + iPosition.xyz,1.);\r\n    vec4 finalPos = vec4(rotPos + iPosition.xyz,1.);\r\n    vAlpha = iPosition.a;\r\n\r\n    gl_Position = projectionMatrix * modelViewMatrix * finalPos;\r\n    //gl_Position =  vec4(position,1.);\r\n\r\n}"},function(t,e){t.exports="precision highp float;\r\nuniform vec2 resolution;\r\nuniform float time;\r\nuniform sampler2D tex;\r\nout vec4 glFragColor;\r\nin float vAlpha;\r\n\r\nconst vec3 baseColor = vec3(212.0,32.0,133.0);\r\n\r\nvoid main() {\r\n    vec2 uv = gl_FragCoord.xy / resolution;\r\n    vec3 color = normalize(baseColor);\r\n    vec4 img = texture(tex,uv);\r\n    // Time varying pixel color\r\n    vec3 col = 0.5 + 0.5*sin(color * time+uv.xyx+vec3(1,0,2));\r\n    col = mix(color,col,0.8) + 0.2;\r\n\r\n\r\n\tglFragColor = vec4(img.xyz, 1.);\r\n    //glFragColor = vec4(1.);\r\n}\r\n"},function(t,e){t.exports="vec3 rotateX(vec3 p, float theta){\r\n  float s = sin(theta);\r\n  float c = cos(theta);\r\n  return vec3(p.x, p.y * c - p.z * s, p.z * c + p.y * s);\r\n}\r\n\r\nvec3 rotateY(vec3 p, float theta) {\r\n  float s = sin(theta);\r\n  float c = cos(theta);\r\n  return vec3(p.x * c + p.z * s, p.y, p.z * c - p.x * s);\r\n}\r\n\r\nvec3 rotateZ(vec3 p, float theta) {\r\n  float s = sin(theta);\r\n  float c = cos(theta);\r\n  return vec3(p.x * c - p.y * s, p.y * c + p.x * s, p.z);\r\n}\r\n\r\n"},function(t,e){t.exports="//\r\n// Description : Array and textureless GLSL 2D simplex noise function.\r\n// Author : Ian McEwan, Ashima Arts.\r\n// Maintainer : ijm\r\n// Lastmod : 20110822 (ijm)\r\n// License : Copyright (C) 2011 Ashima Arts. All rights reserved.\r\n// Distributed under the MIT License. See LICENSE file.\r\n// https://github.com/ashima/webgl-noise\r\n//\r\n\r\nvec3 mod289(vec3 x) {\r\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\r\n}\r\n\r\nvec2 mod289(vec2 x) {\r\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\r\n}\r\n\r\nvec3 permute(vec3 x) {\r\n  return mod289(((x*34.0)+1.0)*x);\r\n}\r\n\r\nfloat snoise(vec2 v)\r\n  {\r\n  const vec4 C = vec4(0.211324865405187, // (3.0-sqrt(3.0))/6.0\r\n                      0.366025403784439, // 0.5*(sqrt(3.0)-1.0)\r\n                     -0.577350269189626, // -1.0 + 2.0 * C.x\r\n                      0.024390243902439); // 1.0 / 41.0\r\n// First corner\r\n  vec2 i = floor(v + dot(v, C.yy) );\r\n  vec2 x0 = v - i + dot(i, C.xx);\r\n\r\n// Other corners\r\n  vec2 i1;\r\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\r\n  //i1.y = 1.0 - i1.x;\r\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\r\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\r\n  // x1 = x0 - i1 + 1.0 * C.xx ;\r\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\r\n  vec4 x12 = x0.xyxy + C.xxzz;\r\n  x12.xy -= i1;\r\n\r\n// Permutations\r\n  i = mod289(i); // Avoid truncation effects in permutation\r\n  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\r\n+ i.x + vec3(0.0, i1.x, 1.0 ));\r\n\r\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\r\n  m = m*m ;\r\n  m = m*m ;\r\n\r\n// Gradients: 41 points uniformly over a line, mapped onto a diamond.\r\n// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\r\n\r\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\r\n  vec3 h = abs(x) - 0.5;\r\n  vec3 ox = floor(x + 0.5);\r\n  vec3 a0 = x - ox;\r\n\r\n// Normalise gradients implicitly by scaling m\r\n// Approximation of: m *= inversesqrt( a0*a0 + h*h );\r\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\r\n\r\n// Compute final noise value at P\r\n  vec3 g;\r\n  g.x = a0.x * x0.x + h.x * x0.y;\r\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\r\n  return 130.0 * dot(m, g);\r\n}\r\n\r\n//\r\n// Description : Array and textureless GLSL 2D/3D/4D simplex\r\n// noise functions.\r\n// Author : Ian McEwan, Ashima Arts.\r\n// Maintainer : ijm\r\n// Lastmod : 20110822 (ijm)\r\n// License : Copyright (C) 2011 Ashima Arts. All rights reserved.\r\n// Distributed under the MIT License. See LICENSE file.\r\n// https://github.com/ashima/webgl-noise\r\n//\r\n\r\n\r\nvec4 mod289(vec4 x) {\r\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\r\n}\r\n\r\nvec4 permute(vec4 x) {\r\n     return mod289(((x*34.0)+1.0)*x);\r\n}\r\n\r\nvec4 taylorInvSqrt(vec4 r)\r\n{\r\n  return 1.79284291400159 - 0.85373472095314 * r;\r\n}\r\n\r\nfloat snoise(vec3 v)\r\n  {\r\n  const vec2 C = vec2(1.0/6.0, 1.0/3.0) ;\r\n  const vec4 D = vec4(0.0, 0.5, 1.0, 2.0);\r\n\r\n// First corner\r\n  vec3 i = floor(v + dot(v, C.yyy) );\r\n  vec3 x0 = v - i + dot(i, C.xxx) ;\r\n\r\n// Other corners\r\n  vec3 g = step(x0.yzx, x0.xyz);\r\n  vec3 l = 1.0 - g;\r\n  vec3 i1 = min( g.xyz, l.zxy );\r\n  vec3 i2 = max( g.xyz, l.zxy );\r\n\r\n  // x0 = x0 - 0.0 + 0.0 * C.xxx;\r\n  // x1 = x0 - i1 + 1.0 * C.xxx;\r\n  // x2 = x0 - i2 + 2.0 * C.xxx;\r\n  // x3 = x0 - 1.0 + 3.0 * C.xxx;\r\n  vec3 x1 = x0 - i1 + C.xxx;\r\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\r\n  vec3 x3 = x0 - D.yyy; // -1.0+3.0*C.x = -0.5 = -D.y\r\n\r\n// Permutations\r\n  i = mod289(i);\r\n  vec4 p = permute( permute( permute(\r\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\r\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\r\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\r\n\r\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\r\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\r\n  float n_ = 0.142857142857; // 1.0/7.0\r\n  vec3 ns = n_ * D.wyz - D.xzx;\r\n\r\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z); // mod(p,7*7)\r\n\r\n  vec4 x_ = floor(j * ns.z);\r\n  vec4 y_ = floor(j - 7.0 * x_ ); // mod(j,N)\r\n\r\n  vec4 x = x_ *ns.x + ns.yyyy;\r\n  vec4 y = y_ *ns.x + ns.yyyy;\r\n  vec4 h = 1.0 - abs(x) - abs(y);\r\n\r\n  vec4 b0 = vec4( x.xy, y.xy );\r\n  vec4 b1 = vec4( x.zw, y.zw );\r\n\r\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\r\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\r\n  vec4 s0 = floor(b0)*2.0 + 1.0;\r\n  vec4 s1 = floor(b1)*2.0 + 1.0;\r\n  vec4 sh = -step(h, vec4(0.0));\r\n\r\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\r\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\r\n\r\n  vec3 p0 = vec3(a0.xy,h.x);\r\n  vec3 p1 = vec3(a0.zw,h.y);\r\n  vec3 p2 = vec3(a1.xy,h.z);\r\n  vec3 p3 = vec3(a1.zw,h.w);\r\n\r\n//Normalise gradients\r\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\r\n  p0 *= norm.x;\r\n  p1 *= norm.y;\r\n  p2 *= norm.z;\r\n  p3 *= norm.w;\r\n\r\n// Mix final noise value\r\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\r\n  m = m * m;\r\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\r\n                                dot(p2,x2), dot(p3,x3) ) );\r\n  }\r\n\r\n\r\n  //\r\n// Description : Array and textureless GLSL 2D/3D/4D simplex\r\n// noise functions.\r\n// Author : Ian McEwan, Ashima Arts.\r\n// Maintainer : ijm\r\n// Lastmod : 20110822 (ijm)\r\n// License : Copyright (C) 2011 Ashima Arts. All rights reserved.\r\n// Distributed under the MIT License. See LICENSE file.\r\n// https://github.com/ashima/webgl-noise\r\n//\r\n\r\nfloat mod289(float x) {\r\n  return x - floor(x * (1.0 / 289.0)) * 289.0; }\r\n\r\nfloat permute(float x) {\r\n     return mod289(((x*34.0)+1.0)*x);\r\n}\r\n\r\n\r\nfloat taylorInvSqrt(float r)\r\n{\r\n  return 1.79284291400159 - 0.85373472095314 * r;\r\n}\r\n\r\nvec4 grad4(float j, vec4 ip)\r\n  {\r\n  const vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\r\n  vec4 p,s;\r\n\r\n  p.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\r\n  p.w = 1.5 - dot(abs(p.xyz), ones.xyz);\r\n  s = vec4(lessThan(p, vec4(0.0)));\r\n  p.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www;\r\n\r\n  return p;\r\n  }\r\n\r\nfloat snoise(vec4 v)\r\n  {\r\n  const vec4 C = vec4( 0.138196601125011, // (5 - sqrt(5))/20 G4\r\n                        0.276393202250021, // 2 * G4\r\n                        0.414589803375032, // 3 * G4\r\n                       -0.447213595499958); // -1 + 4 * G4\r\n\r\n// (sqrt(5) - 1)/4 = F4, used once below\r\n#define F4 0.309016994374947451\r\n\r\n// First corner\r\n  vec4 i = floor(v + dot(v, vec4(F4)) );\r\n  vec4 x0 = v - i + dot(i, C.xxxx);\r\n\r\n// Other corners\r\n\r\n// Rank sorting originally contributed by Bill Licea-Kane, AMD (formerly ATI)\r\n  vec4 i0;\r\n  vec3 isX = step( x0.yzw, x0.xxx );\r\n  vec3 isYZ = step( x0.zww, x0.yyz );\r\n// i0.x = dot( isX, vec3( 1.0 ) );\r\n  i0.x = isX.x + isX.y + isX.z;\r\n  i0.yzw = 1.0 - isX;\r\n// i0.y += dot( isYZ.xy, vec2( 1.0 ) );\r\n  i0.y += isYZ.x + isYZ.y;\r\n  i0.zw += 1.0 - isYZ.xy;\r\n  i0.z += isYZ.z;\r\n  i0.w += 1.0 - isYZ.z;\r\n\r\n  // i0 now contains the unique values 0,1,2,3 in each channel\r\n  vec4 i3 = clamp( i0, 0.0, 1.0 );\r\n  vec4 i2 = clamp( i0-1.0, 0.0, 1.0 );\r\n  vec4 i1 = clamp( i0-2.0, 0.0, 1.0 );\r\n\r\n  // x0 = x0 - 0.0 + 0.0 * C.xxxx\r\n  // x1 = x0 - i1 + 1.0 * C.xxxx\r\n  // x2 = x0 - i2 + 2.0 * C.xxxx\r\n  // x3 = x0 - i3 + 3.0 * C.xxxx\r\n  // x4 = x0 - 1.0 + 4.0 * C.xxxx\r\n  vec4 x1 = x0 - i1 + C.xxxx;\r\n  vec4 x2 = x0 - i2 + C.yyyy;\r\n  vec4 x3 = x0 - i3 + C.zzzz;\r\n  vec4 x4 = x0 + C.wwww;\r\n\r\n// Permutations\r\n  i = mod289(i);\r\n  float j0 = permute( permute( permute( permute(i.w) + i.z) + i.y) + i.x);\r\n  vec4 j1 = permute( permute( permute( permute (\r\n             i.w + vec4(i1.w, i2.w, i3.w, 1.0 ))\r\n           + i.z + vec4(i1.z, i2.z, i3.z, 1.0 ))\r\n           + i.y + vec4(i1.y, i2.y, i3.y, 1.0 ))\r\n           + i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));\r\n\r\n// Gradients: 7x7x6 points over a cube, mapped onto a 4-cross polytope\r\n// 7*7*6 = 294, which is close to the ring size 17*17 = 289.\r\n  vec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\r\n\r\n  vec4 p0 = grad4(j0, ip);\r\n  vec4 p1 = grad4(j1.x, ip);\r\n  vec4 p2 = grad4(j1.y, ip);\r\n  vec4 p3 = grad4(j1.z, ip);\r\n  vec4 p4 = grad4(j1.w, ip);\r\n\r\n// Normalise gradients\r\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\r\n  p0 *= norm.x;\r\n  p1 *= norm.y;\r\n  p2 *= norm.z;\r\n  p3 *= norm.w;\r\n  p4 *= taylorInvSqrt(dot(p4,p4));\r\n\r\n// Mix contributions from the five corners\r\n  vec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);\r\n  vec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4) ), 0.0);\r\n  m0 = m0 * m0;\r\n  m1 = m1 * m1;\r\n  return 49.0 * ( dot(m0*m0, vec3( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 )))\r\n               + dot(m1*m1, vec2( dot( p3, x3 ), dot( p4, x4 ) ) ) ) ;\r\n\r\n  }\r\n// Using  @eddietree implementation from\r\n// His brilliant demo 'Artifacts'\r\n\r\nvec3 snoiseVec3( vec3 x ){\r\n\r\n  float s  = snoise(vec3( x ));\r\n  float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));\r\n  float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));\r\n  vec3 c = vec3( s , s1 , s2 );\r\n  return c;\r\n\r\n}\r\n\r\n\r\nvec3 curlNoise( vec3 p ){\r\n\r\n  const float e = 1e-1;\r\n  vec3 dx = vec3( e   , 0.0 , 0.0 );\r\n  vec3 dy = vec3( 0.0 , e   , 0.0 );\r\n  vec3 dz = vec3( 0.0 , 0.0 , e   );\r\n\r\n  vec3 p_x0 = snoiseVec3( p - dx );\r\n  vec3 p_x1 = snoiseVec3( p + dx );\r\n  vec3 p_y0 = snoiseVec3( p - dy );\r\n  vec3 p_y1 = snoiseVec3( p + dy );\r\n  vec3 p_z0 = snoiseVec3( p - dz );\r\n  vec3 p_z1 = snoiseVec3( p + dz );\r\n\r\n  float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;\r\n  float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;\r\n  float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;\r\n\r\n  const float divisor = 1.0 / ( 2.0 * e );\r\n  return normalize( vec3( x , y , z ) * divisor );\r\n}\r\n"},function(t,e,r){"use strict";r.r(e);function a(t=window.innerWidth,e=window.innerHeight){this.viewportX=0,this.viewportY=0,this.width=t,this.height=e}a.prototype={setViewport(t=0,e=0,r=this.width,a=this.height){return this.viewportX=t,this.viewportY=e,this.width=r,this.height=a,this.canvas.width=r,this.canvas.height=a,this.viewport(t,e,r,a),this},clearColorBit(){return this.clear(this.COLOR_BUFFER_BIT),this},clearDepthBit(){return this.clear(this.DEPTH_BUFFER_BIT),this},clearScreen(t=0,e=0,r=0,a=1){return this.clearColor(t,e,r,a),this.viewport(this.viewportX,this.viewportY,this.canvas.width,this.canvas.height),this.clear(this.COLOR_BUFFER_BIT|this.DEPTH_BUFFER_BIT),this},enableAlphaBlending(){this.enable(this.BLEND),this.blendFunc(this.SRC_ALPHA,this.ONE_MINUS_SRC_ALPHA)},setSize(t=window.innerWidth,e=window.innerHeight){return this.canvas.width=t,this.canvas.height=e,this.width=t,this.height=e,this},setFullscreen(t=null){this.canvas.parentElement;return this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.setViewport(),t?window.addEventListener("resize",t):window.addEventListener("resize",()=>{this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.setViewport(0,0,this.canvas.width,this.canvas.height)}),this}};var n={EPSILON:1e-6};n.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,n.RANDOM=Math.random,n.ENABLE_SIMD=!1,n.SIMD_AVAILABLE=n.ARRAY_TYPE===Float32Array&&"SIMD"in window,n.USE_SIMD=n.ENABLE_SIMD&&n.SIMD_AVAILABLE,n.setMatrixArrayType=function(t){n.ARRAY_TYPE=t};var i=Math.PI/180;n.toRadian=function(t){return t*i},n.equals=function(t,e){return Math.abs(t-e)<=n.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))};var o=n,s=void 0!==window.SIMD?window.SIMD:{},l={scalar:{},SIMD:{},create:function(){var t=new o.ARRAY_TYPE(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},clone:function(t){var e=new o.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},fromValues:function(t,e,r,a,n,i,s,l,h,u,c,x,d,f,m,p){var v=new o.ARRAY_TYPE(16);return v[0]=t,v[1]=e,v[2]=r,v[3]=a,v[4]=n,v[5]=i,v[6]=s,v[7]=l,v[8]=h,v[9]=u,v[10]=c,v[11]=x,v[12]=d,v[13]=f,v[14]=m,v[15]=p,v},set:function(t,e,r,a,n,i,o,s,l,h,u,c,x,d,f,m,p){return t[0]=e,t[1]=r,t[2]=a,t[3]=n,t[4]=i,t[5]=o,t[6]=s,t[7]=l,t[8]=h,t[9]=u,t[10]=c,t[11]=x,t[12]=d,t[13]=f,t[14]=m,t[15]=p,t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}};l.scalar.transpose=function(t,e){if(t===e){var r=e[1],a=e[2],n=e[3],i=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=a,t[9]=i,t[11]=e[14],t[12]=n,t[13]=o,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},l.SIMD.transpose=function(t,e){var r,a,n,i,o,s,l,h,u,c,x=window.SIMD;return r=x.Float32x4.load(e,0),a=x.Float32x4.load(e,4),n=x.Float32x4.load(e,8),i=x.Float32x4.load(e,12),o=x.Float32x4.shuffle(r,a,0,1,4,5),s=x.Float32x4.shuffle(n,i,0,1,4,5),l=x.Float32x4.shuffle(o,s,0,2,4,6),h=x.Float32x4.shuffle(o,s,1,3,5,7),x.Float32x4.store(t,0,l),x.Float32x4.store(t,4,h),o=x.Float32x4.shuffle(r,a,2,3,6,7),s=x.Float32x4.shuffle(n,i,2,3,6,7),u=x.Float32x4.shuffle(o,s,0,2,4,6),c=x.Float32x4.shuffle(o,s,1,3,5,7),x.Float32x4.store(t,8,u),x.Float32x4.store(t,12,c),t},l.transpose=o.USE_SIMD?l.SIMD.transpose:l.scalar.transpose,l.scalar.invert=function(t,e){var r=e[0],a=e[1],n=e[2],i=e[3],o=e[4],s=e[5],l=e[6],h=e[7],u=e[8],c=e[9],x=e[10],d=e[11],f=e[12],m=e[13],p=e[14],v=e[15],b=r*s-a*o,F=r*l-n*o,M=r*h-i*o,g=a*l-n*s,w=a*h-i*s,y=n*h-i*l,z=u*m-c*f,A=u*p-x*f,E=u*v-d*f,S=c*p-x*m,I=c*v-d*m,_=x*v-d*p,T=b*_-F*I+M*S+g*E-w*A+y*z;return T?(T=1/T,t[0]=(s*_-l*I+h*S)*T,t[1]=(n*I-a*_-i*S)*T,t[2]=(m*y-p*w+v*g)*T,t[3]=(x*w-c*y-d*g)*T,t[4]=(l*E-o*_-h*A)*T,t[5]=(r*_-n*E+i*A)*T,t[6]=(p*M-f*y-v*F)*T,t[7]=(u*y-x*M+d*F)*T,t[8]=(o*I-s*E+h*z)*T,t[9]=(a*E-r*I-i*z)*T,t[10]=(f*w-m*M+v*b)*T,t[11]=(c*M-u*w-d*b)*T,t[12]=(s*A-o*S-l*z)*T,t[13]=(r*S-a*A+n*z)*T,t[14]=(m*F-f*g-p*b)*T,t[15]=(u*g-c*F+x*b)*T,t):null},l.SIMD.invert=function(t,e){var r,a,n,i,o,l,h,u,c,x,d=s.Float32x4.load(e,0),f=s.Float32x4.load(e,4),m=s.Float32x4.load(e,8),p=s.Float32x4.load(e,12);return o=s.Float32x4.shuffle(d,f,0,1,4,5),a=s.Float32x4.shuffle(m,p,0,1,4,5),r=s.Float32x4.shuffle(o,a,0,2,4,6),a=s.Float32x4.shuffle(a,o,1,3,5,7),o=s.Float32x4.shuffle(d,f,2,3,6,7),i=s.Float32x4.shuffle(m,p,2,3,6,7),n=s.Float32x4.shuffle(o,i,0,2,4,6),i=s.Float32x4.shuffle(i,o,1,3,5,7),o=s.Float32x4.mul(n,i),o=s.Float32x4.swizzle(o,1,0,3,2),l=s.Float32x4.mul(a,o),h=s.Float32x4.mul(r,o),o=s.Float32x4.swizzle(o,2,3,0,1),l=s.Float32x4.sub(s.Float32x4.mul(a,o),l),h=s.Float32x4.sub(s.Float32x4.mul(r,o),h),h=s.Float32x4.swizzle(h,2,3,0,1),o=s.Float32x4.mul(a,n),o=s.Float32x4.swizzle(o,1,0,3,2),l=s.Float32x4.add(s.Float32x4.mul(i,o),l),c=s.Float32x4.mul(r,o),o=s.Float32x4.swizzle(o,2,3,0,1),l=s.Float32x4.sub(l,s.Float32x4.mul(i,o)),c=s.Float32x4.sub(s.Float32x4.mul(r,o),c),c=s.Float32x4.swizzle(c,2,3,0,1),o=s.Float32x4.mul(s.Float32x4.swizzle(a,2,3,0,1),i),o=s.Float32x4.swizzle(o,1,0,3,2),n=s.Float32x4.swizzle(n,2,3,0,1),l=s.Float32x4.add(s.Float32x4.mul(n,o),l),u=s.Float32x4.mul(r,o),o=s.Float32x4.swizzle(o,2,3,0,1),l=s.Float32x4.sub(l,s.Float32x4.mul(n,o)),u=s.Float32x4.sub(s.Float32x4.mul(r,o),u),u=s.Float32x4.swizzle(u,2,3,0,1),o=s.Float32x4.mul(r,a),o=s.Float32x4.swizzle(o,1,0,3,2),u=s.Float32x4.add(s.Float32x4.mul(i,o),u),c=s.Float32x4.sub(s.Float32x4.mul(n,o),c),o=s.Float32x4.swizzle(o,2,3,0,1),u=s.Float32x4.sub(s.Float32x4.mul(i,o),u),c=s.Float32x4.sub(c,s.Float32x4.mul(n,o)),o=s.Float32x4.mul(r,i),o=s.Float32x4.swizzle(o,1,0,3,2),h=s.Float32x4.sub(h,s.Float32x4.mul(n,o)),u=s.Float32x4.add(s.Float32x4.mul(a,o),u),o=s.Float32x4.swizzle(o,2,3,0,1),h=s.Float32x4.add(s.Float32x4.mul(n,o),h),u=s.Float32x4.sub(u,s.Float32x4.mul(a,o)),o=s.Float32x4.mul(r,n),o=s.Float32x4.swizzle(o,1,0,3,2),h=s.Float32x4.add(s.Float32x4.mul(i,o),h),c=s.Float32x4.sub(c,s.Float32x4.mul(a,o)),o=s.Float32x4.swizzle(o,2,3,0,1),h=s.Float32x4.sub(h,s.Float32x4.mul(i,o)),c=s.Float32x4.add(s.Float32x4.mul(a,o),c),x=s.Float32x4.mul(r,l),x=s.Float32x4.add(s.Float32x4.swizzle(x,2,3,0,1),x),x=s.Float32x4.add(s.Float32x4.swizzle(x,1,0,3,2),x),o=s.Float32x4.reciprocalApproximation(x),x=s.Float32x4.sub(s.Float32x4.add(o,o),s.Float32x4.mul(x,s.Float32x4.mul(o,o))),(x=s.Float32x4.swizzle(x,0,0,0,0))?(s.Float32x4.store(t,0,s.Float32x4.mul(x,l)),s.Float32x4.store(t,4,s.Float32x4.mul(x,h)),s.Float32x4.store(t,8,s.Float32x4.mul(x,u)),s.Float32x4.store(t,12,s.Float32x4.mul(x,c)),t):null},l.invert=o.USE_SIMD?l.SIMD.invert:l.scalar.invert,l.scalar.adjoint=function(t,e){var r=e[0],a=e[1],n=e[2],i=e[3],o=e[4],s=e[5],l=e[6],h=e[7],u=e[8],c=e[9],x=e[10],d=e[11],f=e[12],m=e[13],p=e[14],v=e[15];return t[0]=s*(x*v-d*p)-c*(l*v-h*p)+m*(l*d-h*x),t[1]=-(a*(x*v-d*p)-c*(n*v-i*p)+m*(n*d-i*x)),t[2]=a*(l*v-h*p)-s*(n*v-i*p)+m*(n*h-i*l),t[3]=-(a*(l*d-h*x)-s*(n*d-i*x)+c*(n*h-i*l)),t[4]=-(o*(x*v-d*p)-u*(l*v-h*p)+f*(l*d-h*x)),t[5]=r*(x*v-d*p)-u*(n*v-i*p)+f*(n*d-i*x),t[6]=-(r*(l*v-h*p)-o*(n*v-i*p)+f*(n*h-i*l)),t[7]=r*(l*d-h*x)-o*(n*d-i*x)+u*(n*h-i*l),t[8]=o*(c*v-d*m)-u*(s*v-h*m)+f*(s*d-h*c),t[9]=-(r*(c*v-d*m)-u*(a*v-i*m)+f*(a*d-i*c)),t[10]=r*(s*v-h*m)-o*(a*v-i*m)+f*(a*h-i*s),t[11]=-(r*(s*d-h*c)-o*(a*d-i*c)+u*(a*h-i*s)),t[12]=-(o*(c*p-x*m)-u*(s*p-l*m)+f*(s*x-l*c)),t[13]=r*(c*p-x*m)-u*(a*p-n*m)+f*(a*x-n*c),t[14]=-(r*(s*p-l*m)-o*(a*p-n*m)+f*(a*l-n*s)),t[15]=r*(s*x-l*c)-o*(a*x-n*c)+u*(a*l-n*s),t},l.SIMD.adjoint=function(t,e){var r,a,n,i,o,l,h,u,c,x,d,f,m;return r=s.Float32x4.load(e,0),a=s.Float32x4.load(e,4),n=s.Float32x4.load(e,8),i=s.Float32x4.load(e,12),c=s.Float32x4.shuffle(r,a,0,1,4,5),l=s.Float32x4.shuffle(n,i,0,1,4,5),o=s.Float32x4.shuffle(c,l,0,2,4,6),l=s.Float32x4.shuffle(l,c,1,3,5,7),c=s.Float32x4.shuffle(r,a,2,3,6,7),u=s.Float32x4.shuffle(n,i,2,3,6,7),h=s.Float32x4.shuffle(c,u,0,2,4,6),u=s.Float32x4.shuffle(u,c,1,3,5,7),c=s.Float32x4.mul(h,u),c=s.Float32x4.swizzle(c,1,0,3,2),x=s.Float32x4.mul(l,c),d=s.Float32x4.mul(o,c),c=s.Float32x4.swizzle(c,2,3,0,1),x=s.Float32x4.sub(s.Float32x4.mul(l,c),x),d=s.Float32x4.sub(s.Float32x4.mul(o,c),d),d=s.Float32x4.swizzle(d,2,3,0,1),c=s.Float32x4.mul(l,h),c=s.Float32x4.swizzle(c,1,0,3,2),x=s.Float32x4.add(s.Float32x4.mul(u,c),x),m=s.Float32x4.mul(o,c),c=s.Float32x4.swizzle(c,2,3,0,1),x=s.Float32x4.sub(x,s.Float32x4.mul(u,c)),m=s.Float32x4.sub(s.Float32x4.mul(o,c),m),m=s.Float32x4.swizzle(m,2,3,0,1),c=s.Float32x4.mul(s.Float32x4.swizzle(l,2,3,0,1),u),c=s.Float32x4.swizzle(c,1,0,3,2),h=s.Float32x4.swizzle(h,2,3,0,1),x=s.Float32x4.add(s.Float32x4.mul(h,c),x),f=s.Float32x4.mul(o,c),c=s.Float32x4.swizzle(c,2,3,0,1),x=s.Float32x4.sub(x,s.Float32x4.mul(h,c)),f=s.Float32x4.sub(s.Float32x4.mul(o,c),f),f=s.Float32x4.swizzle(f,2,3,0,1),c=s.Float32x4.mul(o,l),c=s.Float32x4.swizzle(c,1,0,3,2),f=s.Float32x4.add(s.Float32x4.mul(u,c),f),m=s.Float32x4.sub(s.Float32x4.mul(h,c),m),c=s.Float32x4.swizzle(c,2,3,0,1),f=s.Float32x4.sub(s.Float32x4.mul(u,c),f),m=s.Float32x4.sub(m,s.Float32x4.mul(h,c)),c=s.Float32x4.mul(o,u),c=s.Float32x4.swizzle(c,1,0,3,2),d=s.Float32x4.sub(d,s.Float32x4.mul(h,c)),f=s.Float32x4.add(s.Float32x4.mul(l,c),f),c=s.Float32x4.swizzle(c,2,3,0,1),d=s.Float32x4.add(s.Float32x4.mul(h,c),d),f=s.Float32x4.sub(f,s.Float32x4.mul(l,c)),c=s.Float32x4.mul(o,h),c=s.Float32x4.swizzle(c,1,0,3,2),d=s.Float32x4.add(s.Float32x4.mul(u,c),d),m=s.Float32x4.sub(m,s.Float32x4.mul(l,c)),c=s.Float32x4.swizzle(c,2,3,0,1),d=s.Float32x4.sub(d,s.Float32x4.mul(u,c)),m=s.Float32x4.add(s.Float32x4.mul(l,c),m),s.Float32x4.store(t,0,x),s.Float32x4.store(t,4,d),s.Float32x4.store(t,8,f),s.Float32x4.store(t,12,m),t},l.adjoint=o.USE_SIMD?l.SIMD.adjoint:l.scalar.adjoint,l.determinant=function(t){var e=t[0],r=t[1],a=t[2],n=t[3],i=t[4],o=t[5],s=t[6],l=t[7],h=t[8],u=t[9],c=t[10],x=t[11],d=t[12],f=t[13],m=t[14],p=t[15];return(e*o-r*i)*(c*p-x*m)-(e*s-a*i)*(u*p-x*f)+(e*l-n*i)*(u*m-c*f)+(r*s-a*o)*(h*p-x*d)-(r*l-n*o)*(h*m-c*d)+(a*l-n*s)*(h*f-u*d)},l.SIMD.multiply=function(t,e,r){var a=s.Float32x4.load(e,0),n=s.Float32x4.load(e,4),i=s.Float32x4.load(e,8),o=s.Float32x4.load(e,12),l=s.Float32x4.load(r,0),h=s.Float32x4.add(s.Float32x4.mul(s.Float32x4.swizzle(l,0,0,0,0),a),s.Float32x4.add(s.Float32x4.mul(s.Float32x4.swizzle(l,1,1,1,1),n),s.Float32x4.add(s.Float32x4.mul(s.Float32x4.swizzle(l,2,2,2,2),i),s.Float32x4.mul(s.Float32x4.swizzle(l,3,3,3,3),o))));s.Float32x4.store(t,0,h);var u=s.Float32x4.load(r,4),c=s.Float32x4.add(s.Float32x4.mul(s.Float32x4.swizzle(u,0,0,0,0),a),s.Float32x4.add(s.Float32x4.mul(s.Float32x4.swizzle(u,1,1,1,1),n),s.Float32x4.add(s.Float32x4.mul(s.Float32x4.swizzle(u,2,2,2,2),i),s.Float32x4.mul(s.Float32x4.swizzle(u,3,3,3,3),o))));s.Float32x4.store(t,4,c);var x=s.Float32x4.load(r,8),d=s.Float32x4.add(s.Float32x4.mul(s.Float32x4.swizzle(x,0,0,0,0),a),s.Float32x4.add(s.Float32x4.mul(s.Float32x4.swizzle(x,1,1,1,1),n),s.Float32x4.add(s.Float32x4.mul(s.Float32x4.swizzle(x,2,2,2,2),i),s.Float32x4.mul(s.Float32x4.swizzle(x,3,3,3,3),o))));s.Float32x4.store(t,8,d);var f=s.Float32x4.load(r,12),m=s.Float32x4.add(s.Float32x4.mul(s.Float32x4.swizzle(f,0,0,0,0),a),s.Float32x4.add(s.Float32x4.mul(s.Float32x4.swizzle(f,1,1,1,1),n),s.Float32x4.add(s.Float32x4.mul(s.Float32x4.swizzle(f,2,2,2,2),i),s.Float32x4.mul(s.Float32x4.swizzle(f,3,3,3,3),o))));return s.Float32x4.store(t,12,m),t},l.scalar.multiply=function(t,e,r){var a=e[0],n=e[1],i=e[2],o=e[3],s=e[4],l=e[5],h=e[6],u=e[7],c=e[8],x=e[9],d=e[10],f=e[11],m=e[12],p=e[13],v=e[14],b=e[15],F=r[0],M=r[1],g=r[2],w=r[3];return t[0]=F*a+M*s+g*c+w*m,t[1]=F*n+M*l+g*x+w*p,t[2]=F*i+M*h+g*d+w*v,t[3]=F*o+M*u+g*f+w*b,F=r[4],M=r[5],g=r[6],w=r[7],t[4]=F*a+M*s+g*c+w*m,t[5]=F*n+M*l+g*x+w*p,t[6]=F*i+M*h+g*d+w*v,t[7]=F*o+M*u+g*f+w*b,F=r[8],M=r[9],g=r[10],w=r[11],t[8]=F*a+M*s+g*c+w*m,t[9]=F*n+M*l+g*x+w*p,t[10]=F*i+M*h+g*d+w*v,t[11]=F*o+M*u+g*f+w*b,F=r[12],M=r[13],g=r[14],w=r[15],t[12]=F*a+M*s+g*c+w*m,t[13]=F*n+M*l+g*x+w*p,t[14]=F*i+M*h+g*d+w*v,t[15]=F*o+M*u+g*f+w*b,t},l.multiply=o.USE_SIMD?l.SIMD.multiply:l.scalar.multiply,l.mul=l.multiply,l.scalar.translate=function(t,e,r){var a,n,i,o,s,l,h,u,c,x,d,f,m=r[0],p=r[1],v=r[2];return e===t?(t[12]=e[0]*m+e[4]*p+e[8]*v+e[12],t[13]=e[1]*m+e[5]*p+e[9]*v+e[13],t[14]=e[2]*m+e[6]*p+e[10]*v+e[14],t[15]=e[3]*m+e[7]*p+e[11]*v+e[15]):(a=e[0],n=e[1],i=e[2],o=e[3],s=e[4],l=e[5],h=e[6],u=e[7],c=e[8],x=e[9],d=e[10],f=e[11],t[0]=a,t[1]=n,t[2]=i,t[3]=o,t[4]=s,t[5]=l,t[6]=h,t[7]=u,t[8]=c,t[9]=x,t[10]=d,t[11]=f,t[12]=a*m+s*p+c*v+e[12],t[13]=n*m+l*p+x*v+e[13],t[14]=i*m+h*p+d*v+e[14],t[15]=o*m+u*p+f*v+e[15]),t},l.SIMD.translate=function(t,e,r){var a=s.Float32x4.load(e,0),n=s.Float32x4.load(e,4),i=s.Float32x4.load(e,8),o=s.Float32x4.load(e,12),l=s.Float32x4(r[0],r[1],r[2],0);e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11]),a=s.Float32x4.mul(a,s.Float32x4.swizzle(l,0,0,0,0)),n=s.Float32x4.mul(n,s.Float32x4.swizzle(l,1,1,1,1)),i=s.Float32x4.mul(i,s.Float32x4.swizzle(l,2,2,2,2));var h=s.Float32x4.add(a,s.Float32x4.add(n,s.Float32x4.add(i,o)));return s.Float32x4.store(t,12,h),t},l.translate=o.USE_SIMD?l.SIMD.translate:l.scalar.translate,l.scalar.scale=function(t,e,r){var a=r[0],n=r[1],i=r[2];return t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t[3]=e[3]*a,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},l.SIMD.scale=function(t,e,r){var a,n,i,o=window.SIMD,s=o.Float32x4(r[0],r[1],r[2],0);return a=o.Float32x4.load(e,0),o.Float32x4.store(t,0,o.Float32x4.mul(a,o.Float32x4.swizzle(s,0,0,0,0))),n=o.Float32x4.load(e,4),o.Float32x4.store(t,4,o.Float32x4.mul(n,o.Float32x4.swizzle(s,1,1,1,1))),i=o.Float32x4.load(e,8),o.Float32x4.store(t,8,o.Float32x4.mul(i,o.Float32x4.swizzle(s,2,2,2,2))),t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},l.scale=o.USE_SIMD?l.SIMD.scale:l.scalar.scale,l.rotate=function(t,e,r,a){var n,i,s,l,h,u,c,x,d,f,m,p,v,b,F,M,g,w,y,z,A,E,S,I,_=a[0],T=a[1],P=a[2],D=Math.sqrt(_*_+T*T+P*P);return Math.abs(D)<o.EPSILON?null:(_*=D=1/D,T*=D,P*=D,n=Math.sin(r),s=1-(i=Math.cos(r)),l=e[0],h=e[1],u=e[2],c=e[3],x=e[4],d=e[5],f=e[6],m=e[7],p=e[8],v=e[9],b=e[10],F=e[11],M=_*_*s+i,g=T*_*s+P*n,w=P*_*s-T*n,y=_*T*s-P*n,z=T*T*s+i,A=P*T*s+_*n,E=_*P*s+T*n,S=T*P*s-_*n,I=P*P*s+i,t[0]=l*M+x*g+p*w,t[1]=h*M+d*g+v*w,t[2]=u*M+f*g+b*w,t[3]=c*M+m*g+F*w,t[4]=l*y+x*z+p*A,t[5]=h*y+d*z+v*A,t[6]=u*y+f*z+b*A,t[7]=c*y+m*z+F*A,t[8]=l*E+x*S+p*I,t[9]=h*E+d*S+v*I,t[10]=u*E+f*S+b*I,t[11]=c*E+m*S+F*I,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},l.scalar.rotateX=function(t,e,r){var a=Math.sin(r),n=Math.cos(r),i=e[4],o=e[5],s=e[6],l=e[7],h=e[8],u=e[9],c=e[10],x=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=i*n+h*a,t[5]=o*n+u*a,t[6]=s*n+c*a,t[7]=l*n+x*a,t[8]=h*n-i*a,t[9]=u*n-o*a,t[10]=c*n-s*a,t[11]=x*n-l*a,t},l.SIMD.rotateX=function(t,e,r){var a=window.SIMD,n=a.Float32x4.splat(Math.sin(r)),i=a.Float32x4.splat(Math.cos(r));e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var o=a.Float32x4.load(e,4),s=a.Float32x4.load(e,8);return a.Float32x4.store(t,4,a.Float32x4.add(a.Float32x4.mul(o,i),a.Float32x4.mul(s,n))),a.Float32x4.store(t,8,a.Float32x4.sub(a.Float32x4.mul(s,i),a.Float32x4.mul(o,n))),t},l.rotateX=o.USE_SIMD?l.SIMD.rotateX:l.scalar.rotateX,l.scalar.rotateY=function(t,e,r){var a=Math.sin(r),n=Math.cos(r),i=e[0],o=e[1],s=e[2],l=e[3],h=e[8],u=e[9],c=e[10],x=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*n-h*a,t[1]=o*n-u*a,t[2]=s*n-c*a,t[3]=l*n-x*a,t[8]=i*a+h*n,t[9]=o*a+u*n,t[10]=s*a+c*n,t[11]=l*a+x*n,t},l.SIMD.rotateY=function(t,e,r){var a=window.SIMD,n=a.Float32x4.splat(Math.sin(r)),i=a.Float32x4.splat(Math.cos(r));e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var o=a.Float32x4.load(e,0),s=a.Float32x4.load(e,8);return a.Float32x4.store(t,0,a.Float32x4.sub(a.Float32x4.mul(o,i),a.Float32x4.mul(s,n))),a.Float32x4.store(t,8,a.Float32x4.add(a.Float32x4.mul(o,n),a.Float32x4.mul(s,i))),t},l.rotateY=o.USE_SIMD?l.SIMD.rotateY:l.scalar.rotateY,l.scalar.rotateZ=function(t,e,r){var a=Math.sin(r),n=Math.cos(r),i=e[0],o=e[1],s=e[2],l=e[3],h=e[4],u=e[5],c=e[6],x=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*n+h*a,t[1]=o*n+u*a,t[2]=s*n+c*a,t[3]=l*n+x*a,t[4]=h*n-i*a,t[5]=u*n-o*a,t[6]=c*n-s*a,t[7]=x*n-l*a,t},l.SIMD.rotateZ=function(t,e,r){var a=window.SIMD,n=a.Float32x4.splat(Math.sin(r)),i=a.Float32x4.splat(Math.cos(r));e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var o=a.Float32x4.load(e,0),s=a.Float32x4.load(e,4);return a.Float32x4.store(t,0,a.Float32x4.add(a.Float32x4.mul(o,i),a.Float32x4.mul(s,n))),a.Float32x4.store(t,4,a.Float32x4.sub(a.Float32x4.mul(s,i),a.Float32x4.mul(o,n))),t},l.rotateZ=o.USE_SIMD?l.SIMD.rotateZ:l.scalar.rotateZ,l.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},l.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},l.fromRotation=function(t,e,r){var a,n,i,s=r[0],l=r[1],h=r[2],u=Math.sqrt(s*s+l*l+h*h);return Math.abs(u)<o.EPSILON?null:(s*=u=1/u,l*=u,h*=u,a=Math.sin(e),i=1-(n=Math.cos(e)),t[0]=s*s*i+n,t[1]=l*s*i+h*a,t[2]=h*s*i-l*a,t[3]=0,t[4]=s*l*i-h*a,t[5]=l*l*i+n,t[6]=h*l*i+s*a,t[7]=0,t[8]=s*h*i+l*a,t[9]=l*h*i-s*a,t[10]=h*h*i+n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},l.fromXRotation=function(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},l.fromYRotation=function(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},l.fromZRotation=function(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},l.fromRotationTranslation=function(t,e,r){var a=e[0],n=e[1],i=e[2],o=e[3],s=a+a,l=n+n,h=i+i,u=a*s,c=a*l,x=a*h,d=n*l,f=n*h,m=i*h,p=o*s,v=o*l,b=o*h;return t[0]=1-(d+m),t[1]=c+b,t[2]=x-v,t[3]=0,t[4]=c-b,t[5]=1-(u+m),t[6]=f+p,t[7]=0,t[8]=x+v,t[9]=f-p,t[10]=1-(u+d),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},l.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},l.getRotation=function(t,e){var r=e[0]+e[5]+e[10],a=0;return r>0?(a=2*Math.sqrt(r+1),t[3]=.25*a,t[0]=(e[6]-e[9])/a,t[1]=(e[8]-e[2])/a,t[2]=(e[1]-e[4])/a):e[0]>e[5]&&e[0]>e[10]?(a=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/a,t[0]=.25*a,t[1]=(e[1]+e[4])/a,t[2]=(e[8]+e[2])/a):e[5]>e[10]?(a=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/a,t[0]=(e[1]+e[4])/a,t[1]=.25*a,t[2]=(e[6]+e[9])/a):(a=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/a,t[0]=(e[8]+e[2])/a,t[1]=(e[6]+e[9])/a,t[2]=.25*a),t},l.fromRotationTranslationScale=function(t,e,r,a){var n=e[0],i=e[1],o=e[2],s=e[3],l=n+n,h=i+i,u=o+o,c=n*l,x=n*h,d=n*u,f=i*h,m=i*u,p=o*u,v=s*l,b=s*h,F=s*u,M=a[0],g=a[1],w=a[2];return t[0]=(1-(f+p))*M,t[1]=(x+F)*M,t[2]=(d-b)*M,t[3]=0,t[4]=(x-F)*g,t[5]=(1-(c+p))*g,t[6]=(m+v)*g,t[7]=0,t[8]=(d+b)*w,t[9]=(m-v)*w,t[10]=(1-(c+f))*w,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},l.fromRotationTranslationScaleOrigin=function(t,e,r,a,n){var i=e[0],o=e[1],s=e[2],l=e[3],h=i+i,u=o+o,c=s+s,x=i*h,d=i*u,f=i*c,m=o*u,p=o*c,v=s*c,b=l*h,F=l*u,M=l*c,g=a[0],w=a[1],y=a[2],z=n[0],A=n[1],E=n[2];return t[0]=(1-(m+v))*g,t[1]=(d+M)*g,t[2]=(f-F)*g,t[3]=0,t[4]=(d-M)*w,t[5]=(1-(x+v))*w,t[6]=(p+b)*w,t[7]=0,t[8]=(f+F)*y,t[9]=(p-b)*y,t[10]=(1-(x+m))*y,t[11]=0,t[12]=r[0]+z-(t[0]*z+t[4]*A+t[8]*E),t[13]=r[1]+A-(t[1]*z+t[5]*A+t[9]*E),t[14]=r[2]+E-(t[2]*z+t[6]*A+t[10]*E),t[15]=1,t},l.fromQuat=function(t,e){var r=e[0],a=e[1],n=e[2],i=e[3],o=r+r,s=a+a,l=n+n,h=r*o,u=a*o,c=a*s,x=n*o,d=n*s,f=n*l,m=i*o,p=i*s,v=i*l;return t[0]=1-c-f,t[1]=u+v,t[2]=x-p,t[3]=0,t[4]=u-v,t[5]=1-h-f,t[6]=d+m,t[7]=0,t[8]=x+p,t[9]=d-m,t[10]=1-h-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},l.frustum=function(t,e,r,a,n,i,o){var s=1/(r-e),l=1/(n-a),h=1/(i-o);return t[0]=2*i*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*i*l,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(n+a)*l,t[10]=(o+i)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*i*2*h,t[15]=0,t},l.perspective=function(t,e,r,a,n){var i=1/Math.tan(e/2),o=1/(a-n);return t[0]=i/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(n+a)*o,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*n*a*o,t[15]=0,t},l.perspectiveFromFieldOfView=function(t,e,r,a){var n=Math.tan(e.upDegrees*Math.PI/180),i=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+s),h=2/(n+i);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=-(o-s)*l*.5,t[9]=(n-i)*h*.5,t[10]=a/(r-a),t[11]=-1,t[12]=0,t[13]=0,t[14]=a*r/(r-a),t[15]=0,t},l.ortho=function(t,e,r,a,n,i,o){var s=1/(e-r),l=1/(a-n),h=1/(i-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+r)*s,t[13]=(n+a)*l,t[14]=(o+i)*h,t[15]=1,t},l.lookAt=function(t,e,r,a){var n,i,s,h,u,c,x,d,f,m,p=e[0],v=e[1],b=e[2],F=a[0],M=a[1],g=a[2],w=r[0],y=r[1],z=r[2];return Math.abs(p-w)<o.EPSILON&&Math.abs(v-y)<o.EPSILON&&Math.abs(b-z)<o.EPSILON?l.identity(t):(x=p-w,d=v-y,f=b-z,n=M*(f*=m=1/Math.sqrt(x*x+d*d+f*f))-g*(d*=m),i=g*(x*=m)-F*f,s=F*d-M*x,(m=Math.sqrt(n*n+i*i+s*s))?(n*=m=1/m,i*=m,s*=m):(n=0,i=0,s=0),h=d*s-f*i,u=f*n-x*s,c=x*i-d*n,(m=Math.sqrt(h*h+u*u+c*c))?(h*=m=1/m,u*=m,c*=m):(h=0,u=0,c=0),t[0]=n,t[1]=h,t[2]=x,t[3]=0,t[4]=i,t[5]=u,t[6]=d,t[7]=0,t[8]=s,t[9]=c,t[10]=f,t[11]=0,t[12]=-(n*p+i*v+s*b),t[13]=-(h*p+u*v+c*b),t[14]=-(x*p+d*v+f*b),t[15]=1,t)},l.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},l.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},l.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t},l.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t},l.sub=l.subtract,l.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t},l.multiplyScalarAndAdd=function(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t[2]=e[2]+r[2]*a,t[3]=e[3]+r[3]*a,t[4]=e[4]+r[4]*a,t[5]=e[5]+r[5]*a,t[6]=e[6]+r[6]*a,t[7]=e[7]+r[7]*a,t[8]=e[8]+r[8]*a,t[9]=e[9]+r[9]*a,t[10]=e[10]+r[10]*a,t[11]=e[11]+r[11]*a,t[12]=e[12]+r[12]*a,t[13]=e[13]+r[13]*a,t[14]=e[14]+r[14]*a,t[15]=e[15]+r[15]*a,t},l.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},l.equals=function(t,e){var r=t[0],a=t[1],n=t[2],i=t[3],s=t[4],l=t[5],h=t[6],u=t[7],c=t[8],x=t[9],d=t[10],f=t[11],m=t[12],p=t[13],v=t[14],b=t[15],F=e[0],M=e[1],g=e[2],w=e[3],y=e[4],z=e[5],A=e[6],E=e[7],S=e[8],I=e[9],_=e[10],T=e[11],P=e[12],D=e[13],R=e[14],L=e[15];return Math.abs(r-F)<=o.EPSILON*Math.max(1,Math.abs(r),Math.abs(F))&&Math.abs(a-M)<=o.EPSILON*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(n-g)<=o.EPSILON*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(i-w)<=o.EPSILON*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(s-y)<=o.EPSILON*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(l-z)<=o.EPSILON*Math.max(1,Math.abs(l),Math.abs(z))&&Math.abs(h-A)<=o.EPSILON*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(u-E)<=o.EPSILON*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(c-S)<=o.EPSILON*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(x-I)<=o.EPSILON*Math.max(1,Math.abs(x),Math.abs(I))&&Math.abs(d-_)<=o.EPSILON*Math.max(1,Math.abs(d),Math.abs(_))&&Math.abs(f-T)<=o.EPSILON*Math.max(1,Math.abs(f),Math.abs(T))&&Math.abs(m-P)<=o.EPSILON*Math.max(1,Math.abs(m),Math.abs(P))&&Math.abs(p-D)<=o.EPSILON*Math.max(1,Math.abs(p),Math.abs(D))&&Math.abs(v-R)<=o.EPSILON*Math.max(1,Math.abs(v),Math.abs(R))&&Math.abs(b-L)<=o.EPSILON*Math.max(1,Math.abs(b),Math.abs(L))};var h,u=l,c={};c.create=function(){var t=new o.ARRAY_TYPE(3);return t[0]=0,t[1]=0,t[2]=0,t},c.clone=function(t){var e=new o.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},c.fromValues=function(t,e,r){var a=new o.ARRAY_TYPE(3);return a[0]=t,a[1]=e,a[2]=r,a},c.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},c.set=function(t,e,r,a){return t[0]=e,t[1]=r,t[2]=a,t},c.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},c.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t},c.sub=c.subtract,c.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t},c.mul=c.multiply,c.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t},c.div=c.divide,c.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},c.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},c.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t},c.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t},c.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},c.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},c.scaleAndAdd=function(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t[2]=e[2]+r[2]*a,t},c.distance=function(t,e){var r=e[0]-t[0],a=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(r*r+a*a+n*n)},c.dist=c.distance,c.squaredDistance=function(t,e){var r=e[0]-t[0],a=e[1]-t[1],n=e[2]-t[2];return r*r+a*a+n*n},c.sqrDist=c.squaredDistance,c.length=function(t){var e=t[0],r=t[1],a=t[2];return Math.sqrt(e*e+r*r+a*a)},c.len=c.length,c.squaredLength=function(t){var e=t[0],r=t[1],a=t[2];return e*e+r*r+a*a},c.sqrLen=c.squaredLength,c.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},c.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},c.normalize=function(t,e){var r=e[0],a=e[1],n=e[2],i=r*r+a*a+n*n;return i>0&&(i=1/Math.sqrt(i),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i),t},c.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},c.cross=function(t,e,r){var a=e[0],n=e[1],i=e[2],o=r[0],s=r[1],l=r[2];return t[0]=n*l-i*s,t[1]=i*o-a*l,t[2]=a*s-n*o,t},c.lerp=function(t,e,r,a){var n=e[0],i=e[1],o=e[2];return t[0]=n+a*(r[0]-n),t[1]=i+a*(r[1]-i),t[2]=o+a*(r[2]-o),t},c.hermite=function(t,e,r,a,n,i){var o=i*i,s=o*(2*i-3)+1,l=o*(i-2)+i,h=o*(i-1),u=o*(3-2*i);return t[0]=e[0]*s+r[0]*l+a[0]*h+n[0]*u,t[1]=e[1]*s+r[1]*l+a[1]*h+n[1]*u,t[2]=e[2]*s+r[2]*l+a[2]*h+n[2]*u,t},c.bezier=function(t,e,r,a,n,i){var o=1-i,s=o*o,l=i*i,h=s*o,u=3*i*s,c=3*l*o,x=l*i;return t[0]=e[0]*h+r[0]*u+a[0]*c+n[0]*x,t[1]=e[1]*h+r[1]*u+a[1]*c+n[1]*x,t[2]=e[2]*h+r[2]*u+a[2]*c+n[2]*x,t},c.random=function(t,e){e=e||1;var r=2*o.RANDOM()*Math.PI,a=2*o.RANDOM()-1,n=Math.sqrt(1-a*a)*e;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t[2]=a*e,t},c.transformMat4=function(t,e,r){var a=e[0],n=e[1],i=e[2],o=r[3]*a+r[7]*n+r[11]*i+r[15];return o=o||1,t[0]=(r[0]*a+r[4]*n+r[8]*i+r[12])/o,t[1]=(r[1]*a+r[5]*n+r[9]*i+r[13])/o,t[2]=(r[2]*a+r[6]*n+r[10]*i+r[14])/o,t},c.transformMat3=function(t,e,r){var a=e[0],n=e[1],i=e[2];return t[0]=a*r[0]+n*r[3]+i*r[6],t[1]=a*r[1]+n*r[4]+i*r[7],t[2]=a*r[2]+n*r[5]+i*r[8],t},c.transformQuat=function(t,e,r){var a=e[0],n=e[1],i=e[2],o=r[0],s=r[1],l=r[2],h=r[3],u=h*a+s*i-l*n,c=h*n+l*a-o*i,x=h*i+o*n-s*a,d=-o*a-s*n-l*i;return t[0]=u*h+d*-o+c*-l-x*-s,t[1]=c*h+d*-s+x*-o-u*-l,t[2]=x*h+d*-l+u*-s-c*-o,t},c.rotateX=function(t,e,r,a){var n=[],i=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],i[0]=n[0],i[1]=n[1]*Math.cos(a)-n[2]*Math.sin(a),i[2]=n[1]*Math.sin(a)+n[2]*Math.cos(a),t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t},c.rotateY=function(t,e,r,a){var n=[],i=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],i[0]=n[2]*Math.sin(a)+n[0]*Math.cos(a),i[1]=n[1],i[2]=n[2]*Math.cos(a)-n[0]*Math.sin(a),t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t},c.rotateZ=function(t,e,r,a){var n=[],i=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],i[0]=n[0]*Math.cos(a)-n[1]*Math.sin(a),i[1]=n[0]*Math.sin(a)+n[1]*Math.cos(a),i[2]=n[2],t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t},c.forEach=(h=c.create(),function(t,e,r,a,n,i){var o,s;for(e||(e=3),r||(r=0),s=a?Math.min(a*e+r,t.length):t.length,o=r;o<s;o+=e)h[0]=t[o],h[1]=t[o+1],h[2]=t[o+2],n(h,h,i),t[o]=h[0],t[o+1]=h[1],t[o+2]=h[2];return t}),c.angle=function(t,e){var r=c.fromValues(t[0],t[1],t[2]),a=c.fromValues(e[0],e[1],e[2]);c.normalize(r,r),c.normalize(a,a);var n=c.dot(r,a);return n>1?0:Math.acos(n)},c.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},c.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},c.equals=function(t,e){var r=t[0],a=t[1],n=t[2],i=e[0],s=e[1],l=e[2];return Math.abs(r-i)<=o.EPSILON*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(a-s)<=o.EPSILON*Math.max(1,Math.abs(a),Math.abs(s))&&Math.abs(n-l)<=o.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))};var x=c;class d{constructor(){this.eye=x.create(),this.target=x.create(),this.center=x.create(),this.position=x.create(),this.up=x.create(0,1,0)}translate(t){return this}cameraLookAt(t,e){return this.eye=x.clone(t),this.center=void 0!==e?x.clone(e):this.center,x.copy(this.position,t),u.identity(this.viewMatrix),u.lookAt(this.viewMatrix,t,this.center,this.up),this}setZoom(t){return this.zoom=t,this.position=[0,0,t],this.cameraLookAt([0,0,0]),u.translate(this.viewMatrix,this.viewMatrix,[0,0,t]),this}}var f=function(t){let e=t.createVertexArray();for(let t in m.prototype)e[t]=m.prototype[t];return Object.assign(e,new m(t)),e};function m(t){this.gl=t}m.prototype={bind(){this.gl.bindVertexArray(this)},unbind(){this.gl.bindVertexArray(null)},makeInstancedAttribute(t,e=1){return this.gl.vertexAttribDivisor(t,e),this},enableAttrib(t=0){return this.gl.enableVertexAttribArray(t),this},disableAttrib(t=0){return this.gl.disableVertexAttribArray(t),this},enable(t=0){return this.enableAttrib(t),this},disable(t){return this.disableAttrib(t),this},assignData(t=0,e=3,r=this.gl.FLOAT,a=this.gl.FALSE,n=0,i=0){return this.gl.vertexAttribPointer(t,e,r,a,n,i),this}};var p=function(t,e=!1,r){let a=t.createBuffer();if(e){for(let t in b.prototype)a[t]=b.prototype[t];Object.assign(a,new b(t))}else{for(let t in v.prototype)a[t]=v.prototype[t];Object.assign(a,new v(t))}return void 0!==r&&a.bufferData(r),a};function v(t){this.gl=t}function b(t){this.gl=t}v.prototype={bind(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this)},unbind(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)},bufferData(t,e=this.gl.STATIC_DRAW){return this.bind(),this.gl.bufferData(this.gl.ARRAY_BUFFER,t,e),this.unbind(),this},updateBuffer(t,e=0){return this.gl.bufferSubData(this.gl.ARRAY_BUFFER,e,t),this}},b.prototype={bind(){this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this)},unbind(){this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null)},bufferData(t,e=this.gl.STATIC_DRAW){return this.bind(),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,t,e),this.unbind(),this},updateBuffer(t,e=0){return this.gl.bufferSubData(this.gl.ELEMENT_ARRAY_BUFFER,e,t),this}};var F={create:function(){var t=new o.ARRAY_TYPE(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromMat4:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},clone:function(t){var e=new o.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},fromValues:function(t,e,r,a,n,i,s,l,h){var u=new o.ARRAY_TYPE(9);return u[0]=t,u[1]=e,u[2]=r,u[3]=a,u[4]=n,u[5]=i,u[6]=s,u[7]=l,u[8]=h,u},set:function(t,e,r,a,n,i,o,s,l,h){return t[0]=e,t[1]=r,t[2]=a,t[3]=n,t[4]=i,t[5]=o,t[6]=s,t[7]=l,t[8]=h,t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},transpose:function(t,e){if(t===e){var r=e[1],a=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=a,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},invert:function(t,e){var r=e[0],a=e[1],n=e[2],i=e[3],o=e[4],s=e[5],l=e[6],h=e[7],u=e[8],c=u*o-s*h,x=-u*i+s*l,d=h*i-o*l,f=r*c+a*x+n*d;return f?(f=1/f,t[0]=c*f,t[1]=(-u*a+n*h)*f,t[2]=(s*a-n*o)*f,t[3]=x*f,t[4]=(u*r-n*l)*f,t[5]=(-s*r+n*i)*f,t[6]=d*f,t[7]=(-h*r+a*l)*f,t[8]=(o*r-a*i)*f,t):null},adjoint:function(t,e){var r=e[0],a=e[1],n=e[2],i=e[3],o=e[4],s=e[5],l=e[6],h=e[7],u=e[8];return t[0]=o*u-s*h,t[1]=n*h-a*u,t[2]=a*s-n*o,t[3]=s*l-i*u,t[4]=r*u-n*l,t[5]=n*i-r*s,t[6]=i*h-o*l,t[7]=a*l-r*h,t[8]=r*o-a*i,t},determinant:function(t){var e=t[0],r=t[1],a=t[2],n=t[3],i=t[4],o=t[5],s=t[6],l=t[7],h=t[8];return e*(h*i-o*l)+r*(-h*n+o*s)+a*(l*n-i*s)},multiply:function(t,e,r){var a=e[0],n=e[1],i=e[2],o=e[3],s=e[4],l=e[5],h=e[6],u=e[7],c=e[8],x=r[0],d=r[1],f=r[2],m=r[3],p=r[4],v=r[5],b=r[6],F=r[7],M=r[8];return t[0]=x*a+d*o+f*h,t[1]=x*n+d*s+f*u,t[2]=x*i+d*l+f*c,t[3]=m*a+p*o+v*h,t[4]=m*n+p*s+v*u,t[5]=m*i+p*l+v*c,t[6]=b*a+F*o+M*h,t[7]=b*n+F*s+M*u,t[8]=b*i+F*l+M*c,t}};F.mul=F.multiply,F.translate=function(t,e,r){var a=e[0],n=e[1],i=e[2],o=e[3],s=e[4],l=e[5],h=e[6],u=e[7],c=e[8],x=r[0],d=r[1];return t[0]=a,t[1]=n,t[2]=i,t[3]=o,t[4]=s,t[5]=l,t[6]=x*a+d*o+h,t[7]=x*n+d*s+u,t[8]=x*i+d*l+c,t},F.rotate=function(t,e,r){var a=e[0],n=e[1],i=e[2],o=e[3],s=e[4],l=e[5],h=e[6],u=e[7],c=e[8],x=Math.sin(r),d=Math.cos(r);return t[0]=d*a+x*o,t[1]=d*n+x*s,t[2]=d*i+x*l,t[3]=d*o-x*a,t[4]=d*s-x*n,t[5]=d*l-x*i,t[6]=h,t[7]=u,t[8]=c,t},F.scale=function(t,e,r){var a=r[0],n=r[1];return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},F.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},F.fromRotation=function(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=r,t[2]=0,t[3]=-r,t[4]=a,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},F.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},F.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},F.fromQuat=function(t,e){var r=e[0],a=e[1],n=e[2],i=e[3],o=r+r,s=a+a,l=n+n,h=r*o,u=a*o,c=a*s,x=n*o,d=n*s,f=n*l,m=i*o,p=i*s,v=i*l;return t[0]=1-c-f,t[3]=u-v,t[6]=x+p,t[1]=u+v,t[4]=1-h-f,t[7]=d-m,t[2]=x-p,t[5]=d+m,t[8]=1-h-c,t},F.normalFromMat4=function(t,e){var r=e[0],a=e[1],n=e[2],i=e[3],o=e[4],s=e[5],l=e[6],h=e[7],u=e[8],c=e[9],x=e[10],d=e[11],f=e[12],m=e[13],p=e[14],v=e[15],b=r*s-a*o,F=r*l-n*o,M=r*h-i*o,g=a*l-n*s,w=a*h-i*s,y=n*h-i*l,z=u*m-c*f,A=u*p-x*f,E=u*v-d*f,S=c*p-x*m,I=c*v-d*m,_=x*v-d*p,T=b*_-F*I+M*S+g*E-w*A+y*z;return T?(T=1/T,t[0]=(s*_-l*I+h*S)*T,t[1]=(l*E-o*_-h*A)*T,t[2]=(o*I-s*E+h*z)*T,t[3]=(n*I-a*_-i*S)*T,t[4]=(r*_-n*E+i*A)*T,t[5]=(a*E-r*I-i*z)*T,t[6]=(m*y-p*w+v*g)*T,t[7]=(p*M-f*y-v*F)*T,t[8]=(f*w-m*M+v*b)*T,t):null},F.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},F.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},F.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t},F.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t},F.sub=F.subtract,F.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t},F.multiplyScalarAndAdd=function(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t[2]=e[2]+r[2]*a,t[3]=e[3]+r[3]*a,t[4]=e[4]+r[4]*a,t[5]=e[5]+r[5]*a,t[6]=e[6]+r[6]*a,t[7]=e[7]+r[7]*a,t[8]=e[8]+r[8]*a,t},F.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},F.equals=function(t,e){var r=t[0],a=t[1],n=t[2],i=t[3],s=t[4],l=t[5],h=t[6],u=t[7],c=t[8],x=e[0],d=e[1],f=e[2],m=e[3],p=e[4],v=e[5],b=e[6],F=e[7],M=e[8];return Math.abs(r-x)<=o.EPSILON*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(a-d)<=o.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(n-f)<=o.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(i-m)<=o.EPSILON*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(s-p)<=o.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(l-v)<=o.EPSILON*Math.max(1,Math.abs(l),Math.abs(v))&&Math.abs(h-b)<=o.EPSILON*Math.max(1,Math.abs(h),Math.abs(b))&&Math.abs(u-F)<=o.EPSILON*Math.max(1,Math.abs(u),Math.abs(F))&&Math.abs(c-M)<=o.EPSILON*Math.max(1,Math.abs(c),Math.abs(M))};function M(t,e=!1){(window.jraDebug||e)&&console.log(`%c ${t}`,"background:red;color:white; padding-left:2px; padding-right:2px;")}function g(t,e=!1){(window.jraDebug||e)&&console.log(`%c ${t}`,"background:#46A6B2;padding:4px; color:white;")}window.jraDebug=!1,window.toggleDebug=function(){window.jraDebug=!window.jraDebug};var w=function(t,e){if(void 0===e)return;let r=t.createProgram();for(let t in y.prototype)r[t]=y.prototype[t];let a=new y(t,e);return Object.assign(r,a),r.loadShader(),r};function y(t,e){this.gl=t,this.uniforms=void 0!==e.uniforms?e.uniforms:{},this.attributes=void 0!==e.attributes?e.attributes:{},this.version=`#version ${e.version} \n`,this.precision="highp float",this.spec=e,this.name=e.name}y.prototype={loadShader(t=this.spec.vertex,e=this.spec.fragment){let r=this.gl;t=this.version+t,e=this.version+e;let a=this._compileShader(r.VERTEX_SHADER,t),n=this._compileShader(r.FRAGMENT_SHADER,e);if(r.attachShader(this,a),r.attachShader(this,n),this._parseTransformFeedback(),r.linkProgram(this),r.deleteShader(a),r.deleteShader(n),r.getProgramParameter(this,r.LINK_STATUS))return window.jraDebug&&(""!==this.name?g(`Shader "${this.name}" compiled successfully`):g("Shader compiled successfully")),this._parseActiveAttributes(),this._parseActiveUniforms(),this;throw M(`Could not initialize WebGLProgram ${this.name}`),"Couldn't link shader program - "+r.getProgramInfoLog(this)},bind(){this.gl.useProgram(this)},delete(){this.gl.deleteProgram(this)},_parseActiveUniforms(){let t=this.gl,e=t.getProgramParameter(this,t.ACTIVE_UNIFORMS);for(let r=0;r<e;++r){let e=t.getActiveUniform(this,r),a=t.getUniformLocation(this,e.name);this.uniforms[e.name]={location:a,name:e.name}}},_parseTransformFeedback(){this.spec.varyings.length>0&&null!==this.spec.feedbackMode&&this.setVaryings(this.spec.varyings,this.spec.feedbackMode)},_parseActiveAttributes(){let t=this.gl,e=t.getProgramParameter(this,t.ACTIVE_ATTRIBUTES);for(let r=0;r<e;++r){let e=t.getActiveAttrib(this,r),a=t.getAttribLocation(this,e.name);null!==a&&(this.attributes[e.name]={size:e.size,name:e.name,type:e.type,location:a})}},_compileShader(t,e){let r=this.gl,a=r.createShader(t),n="";if(n=t===r.FRAGMENT_SHADER?"FRAGMENT":"VERTEX",r.shaderSource(a,e),r.compileShader(a),r.getShaderParameter(a,r.COMPILE_STATUS))return a;throw this.name?M(`Error in ${n} shader compilation with "${this.name}" - `+r.getShaderInfoLog(a)+`\n source was :\n ${e}`,!0):(M(`Error in ${n} shader compilation with ${this.name} - `+r.getShaderInfoLog(a),!0),console.log(e)),new Error("Shader error - see message")},setVaryings(t,e){this.gl.transformFeedbackVaryings(this,t,e)},uniform(t,e){if(e instanceof Array||"[object ArrayBuffer]"===Object.prototype.toString.call(e.buffer))switch(e.length){case 2:this.vec2(t,e);break;case 3:this.vec3(t,e);break;case 9:this.mat3(t,e);break;case 16:this.mat4(t,e)}else e.toString().search(".")?this.float(t,e):this.int(t,e);return this},vec2(t,e){return void 0!==this.uniforms[t]&&this.gl.uniform2fv(this.uniforms[t].location,e),this},vec3(t,e){return void 0!==this.uniforms[t]&&this.gl.uniform3fv(this.uniforms[t].location,e),this},int(t,e){return void 0!==this.uniforms[t]&&this.gl.uniform1i(this.uniforms[t].location,e),this},float(t,e){return void 0!==this.uniforms[t]&&this.gl.uniform1f(this.uniforms[t].location,e),this},mat4(t,e){return void 0!==this.uniforms[t]&&this.gl.uniformMatrix4fv(this.uniforms[t].location,!1,e),this},mat3(t,e){return void 0!==this.uniforms[t]&&this.gl.uniformMatrix3fv(this.uniforms[t].location,!1,e),this}};class z{constructor(t=null,{data:e=null,isdepth:r=!1}={}){if(this.name=" ",null!==t)return this.wrapS=t.CLAMP_TO_EDGE,this.wrapT=t.CLAMP_TO_EDGE,this.width=512,this.height=512,this.minFilter=t.NEAREST,this.magFilter=t.NEAREST,this.internalFormat=t.RGB,this.format=t.RGB,this.texelType=t.UNSIGNED_BYTE,this.level=0,this.flipY=!0,this.attachments=[],this.data=null,null!==e&&(this.data=e),r||(this.target=t.TEXTURE_2D),this;M("Unable to init TextureFormat - no WebGL context")}setWidth(t){return this.width=t,this}setHeight(t){return this.height=t,this}setTarget(t){return this.target=t,this}setInternalFormat(t){return this.internalFormat=t,this}toggleFlipY(){return this.flipY=!this.flipY,this}}class A{constructor(){return this.name="",this.version="300 es",this.varyings=[],this.feedbackMode=null,this.uniforms=[],this.attributes=[],this}setVaryings(t){return this.varyings=t,this}setFeedbackMode(t){return this.feedbackMode=t,this}vertexSource(t){return this.vertex=t,this}vertexSources(t){return this.vertex=t.join("\n"),this}fragmentSource(t){return this.fragment=t,this}fragmentSources(t){return this.fragment=t.join("\n"),this}uniform(t){return this.uniforms.push(t),this}setVersion(t){return this.version=t,this}}var E=class{constructor(t,{numItems:e=100}={}){this.attributes=[],this.varyings=[],this.flag=0,this.shader=null,this.gl=t,this.tf=t.createTransformFeedback(),this.feedbackMode=t.SEPARATE_ATTRIBS,this.numItems=e,this.feedbackPrim=t.POINTS,this.vaos=[f(t),f(t)]}bind(){this.vaos[this.flag].bind()}unbind(){this.vaos[this.flag].unbind()}addAttribute(t,e,{size:r=3,normalized:a=this.gl.FALSE,format:n=this.gl.FLOAT,stride:i=0,offset:o=0}={}){let s,l,h=new Float32Array(e),u=this.gl,c=this.attributes.length;for(let t=0;t<2;++t)this.vaos[t].bind(),s=p(this.gl,!1,h),l=p(this.gl,!1,h),s.bind(),u.vertexAttribPointer(c,r,n,a,i,o),u.enableVertexAttribArray(c),s.unbind(),l.bind(),u.vertexAttribPointer(c,r,n,a,i,o),u.enableVertexAttribArray(c),l.unbind(),this.vaos[t].unbind();return this.attributes.push({vbos:[s,l],location:c,size:r,type:n,normalized:a,stride:i,offset:o,name:t}),this}update(){if(null===this.shader)return;let t=this.gl,e=this.flag,r=(this.flag+1)%2;this.shader.bind(),this.vaos[e].bind(),t.enable(t.RASTERIZER_DISCARD),t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,this.tf),this._bindBufferBase(r),this._enableVertexAttribs(),t.beginTransformFeedback(this.feedbackPrim),t.drawArrays(this.feedbackPrim,0,this.numItems),t.endTransformFeedback(),this.vaos[e].unbind(),this._unbindBufferBase(),t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null),t.disable(t.RASTERIZER_DISCARD),this.flag=(this.flag+1)%2}setShader(t,e,r){e.length>0&&e.forEach(t=>{this.addVarying(t)});let a={vertex:t,fragment:["precision highp float;","out vec4 glFragColor;","void main(){","glFragColor = vec4(1.);","}"]};this.shader=w(this.gl,(new A).vertexSource(a.vertex).fragmentSource(a.fragment.join("")).setVaryings(this.varyings).setFeedbackMode(this.feedbackMode))}addVarying(t){return this.varyings.push(t),this}_bindBufferBase(t){let e=this.gl,r=this.attributes.length;for(let a=0;a<r;++a)e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,a,this.attributes[a].vbos[t])}_unbindBufferBase(){let t=this.gl,e=this.attributes.length;for(let r=0;r<e;++r)t.bindBufferBase(t.TRANSFORM_FEEDBACK_BUFFER,r,null)}_enableVertexAttribs(){let t=this.gl,e=this.attributes.length;this.vaos[this.flag].bind();for(let r=0;r<e;++r){let e=this.attributes[r];this.attributes[r].vbos[this.flag].bind(),t.vertexAttribPointer(r,e.size,e.type,e.normalized,e.stride,e.offset),t.enableVertexAttribArray(r)}}getAttributeData(t){for(let t=0;t<this.attributes.length;++t)if(void 0!==this.attributes[t].name)return this.attributes[t].vbos[this.flag]}};function S(t,e=3){let r=[],a=t.length;for(let n=0;n<a;++n){let a=t[n];4===e?r.push(a[0],a[1],a[2],a[3]):3===e?r.push(a[0],a[1],a[2]):r.push(a[0],a[1])}return r=r.map(t=>null==t?0:t)}function I(t=1){return[Math.random()*t,Math.random()*t,Math.random()*t]}function _(t=1){return[Math.random()*t,Math.random()*t,Math.random()*t,Math.random()*t]}var T=r(0),P=r.n(T),D=r(1),R=r.n(D),L=r(2),O=r.n(L),N=r(3),C=r.n(N),B=r(4),V=r.n(B);class j{constructor(t,e){this.framebuffer=null,this.isIndexed=!1,this.isInstanced=!1,this.modelMatrix=u.create();let r=t.gl;this.gl=t.gl,this.shader=t,this.vao=f(r),this.attributes=t.attributes,this.attribData=[],this.numVertices=0,this.primMode=r.TRIANGLES}setPrimitiveMode(t){return this.primMode=t,this}translate(t){return this.modelMatrix[12]=t[0],this.modelMatrix[13]=t[1],this.modelMatrix[14]=t[2],this}additiveTranslate(t){return u.translate(this.modelMatrix,this.modelMatrix,t),this}draw(t){let e=this.gl;this.framebuffer&&this.framebuffer.bind(),this.shader.bind(),this.vao.bind(),this.shader.uniform("projectionMatrix",t.projectionMatrix),this.shader.uniform("modelViewMatrix",t.viewMatrix),this.shader.uniform("modelMatrix",this.modelMatrix),this._enableAttributes(),this.isInstanced?this.isIndexed?(this.indexVbo.bind(),e.drawElementsInstanced(this.primMode,this.numVertices,e.UNSIGNED_SHORT,0,this.numItems),this.indexVbo.unbind()):e.drawArraysInstanced(this.primMode,0,this.numVertices,this.numItems):this.isIndexed?(this.indexVbo.bind(),e.drawElements(this.primMode,this.numVertices,e.UNSIGNED_SHORT,0),this.indexVbo.unbind()):e.drawArrays(this.primMode,0,this.numVertices),this._disableAttributes(),this.vao.unbind(),this.framebuffer&&this.framebuffer.unbind()}uniform(t,e){return this.shader.uniform(t,e),this}_enableAttributes(){for(let t in this.attributes){let e=this.attributes[t];this.vao.enable(e.location)}}_disableAttributes(){for(let t in this.attributes){let e=this.attributes[t];this.vao.disable(e.location)}}fbo(t){return this.framebuffer=t,this}getRenderedMesh(){return this.framebuffer?this.framebuffer.getColorTexture():(console.warn("Mesh::getRenderedMesh called with no FBO assigned. Returning mesh object"),this)}addIndexBuffer(t){let e=this.gl;this.vao.bind();let r=new Uint16Array(t);return this.indexVbo=p(e,!0,r),this.vao.unbind(),this.isIndexed=!0,this.numVertices=t.length,this}addInstancedAttribute(t,e,{size:r=3,divisor:a=1,normalized:n=this.gl.FALSE,format:i=this.gl.FLOAT,stride:o=0,offset:s=0}={}){this.addAttribute(t,e,{size:r,normalized:n,format:i,stride:o,offset:s});let l=this.attributes[t];this.vao.bind(),l.buffer.bind(),this.vao.makeInstancedAttribute(l.location,a),l.buffer.unbind(),this.vao.unbind(),this.isInstanced=!0}addAttributeBuffer(t,e,{size:r=3,normalized:a=this.gl.FALSE,format:n=this.gl.FLOAT,stride:i=0,offset:o=0}={}){if(this.vao.bind(),e.bind(),this.attributes.hasOwnProperty(t)){let s=this.attributes[t];this.vao.enable(s.location),this.vao.assignData(s.location,r,n,a,i,o),s.data=null,s.buffer=e,this.vao.disable(s.location),this.attribData.push(s)}else{let s=this.attribData.length,l={location:s,name:t,data:null,buffer:e};this.gl.bindAttribLocation(this.shader,l.location,t),this.vao.enable(s),this.vao.assignData(s,r,n,a,i,o),this.vao.disable(l.location),this.attribData.push(l)}e.unbind(),this.vao.unbind()}addInstancedAttributeBuffer(t,e,{size:r=3,normalized:a=this.gl.FALSE,format:n=this.gl.FLOAT,stride:i=0,offset:o=0,divisor:s=1,numItems:l=100}={}){if(this.vao.bind(),e.bind(),this.attributes.hasOwnProperty(t)){let l=this.attributes[t];this.vao.enable(l.location),this.vao.assignData(l.location,r,n,a,i,o),l.data=null,l.buffer=e,this.vao.makeInstancedAttribute(l.location,s),this.vao.disable(l.location),this.attribData.push(l)}else{let l=this.attribData.length,h={location:l,name:t,data:null,buffer:e};this.gl.bindAttribLocation(this.shader,h.location,t),this.vao.enable(l),this.vao.assignData(l,r,n,a,i,o),this.vao.makeInstancedAttribute(l,s),this.vao.disable(h.location),this.attribData.push(h)}return e.unbind(),this.vao.unbind(),this.isInstanced=!0,this.numItems=l,this}addAttribute(t,e,{size:r=3,normalized:a=this.gl.FALSE,format:n=this.gl.FLOAT,stride:i=0,offset:o=0}={}){let s=null;s=n==this.gl.FLOAT?new Float32Array(e):new Uint16Array(e),this.vao.bind();let l=p(this.gl,!1,s);if(l.bind(),this.attributes.hasOwnProperty(t)){let e=this.attributes[t];this.vao.enable(e.location),this.vao.assignData(e.location,r,n,a,i,o),e.data=s,e.buffer=l,this.vao.disable(e.location),this.attribData.push(e)}else{let s=this.attribData.length,h={location:s,name:t,data:e,buffer:l};this.gl.bindAttribLocation(this.shader,h.location,t),this.vao.enable(s),this.vao.assignData(s,r,n,a,i,o),this.vao.disable(h.location),this.attribData.push(h)}return"position"!==t&&"Position"!==t||(this.numVertices=e.length/r),l.unbind(),this.vao.unbind(),this}setNumItems(t=1){return this.numItems=t,this}setNumVertices(t){return this.numVertices=t,this}getAttributeData(t){}}class U{constructor(t,e,r,a=100){this.gl=t,this.numParticles=a,this.tf=new E(t,{numItems:a});let n=[V.a,P.a].join("\n");this.resolution=r,this.tf.setShader(n,["oPos","oVel"],[]),this.renderShader=w(t,(new A).vertexSource([C.a,R.a].join("\n")).fragmentSource(O.a)),this._loadGeometry(e)}draw(t){let e=.005*performance.now();this.tf.update(),this.petal.draw(t),this.petal.shader.float("time",e),this.petal.uniform("projectionMatrix",t.projectionMatrix).uniform("modelViewMatrix",t.viewMatrix).uniform("resolution",this.resolution)}_build(){let t=[],e=[],r=[];for(let a=0;a<this.numParticles;++a){let n=_();n[2]-=30;let i=I(.004*a);t.push(...n),e.push(...i),r.push(n[0],n[1],n[2])}this.tf.addAttribute("position",t,{size:4}),this.tf.addAttribute("velocity",e),this.tf.addAttribute("origin",r)}_loadGeometry(t){this._build();let e=t,r=S(e.positions),a=(S(e.coords,2),[]);for(let t=0;t<this.numParticles;++t)a.push(Math.random()+1);this.petal=new j(this.renderShader),this.petal.addAttribute("position",r),this.petal.addInstancedAttributeBuffer("iPosition",this.tf.getAttributeData("position"),{size:4,numItems:100}),this.petal.addInstancedAttribute("iScale",a,{size:1}),this.petal.numItems=this.numParticles}}class Y{constructor(t=""){this.path=t}loadModel(t=""){if(""!==(t=""!==t?t:this.path))return Y.parse(t)}loadModelFromUrl(t=""){if(""!==(t=""!==t?t:this.path))return new Promise((e,r)=>{fetch(t).then(t=>t.text()).then(t=>{let r=Y.parse(t);e(r)}).catch(t=>{r(t)})})}static parse(t){const e=t.split("\n"),r=[],a=[],n=[],i=[],o=[],s=[],l=[];let h,u=0;const c=/v( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,x=/vn( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,d=/vt( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,f=/f( +-?\d+)( +-?\d+)( +-?\d+)( +-?\d+)?/,m=/f( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))?/,p=/f( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))?/,v=/f( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))?/;function b(t){const e=parseInt(t);return 3*(e>=0?e-1:e+i.length/3)}function F(t){const e=parseInt(t);return 3*(e>=0?e-1:e+o.length/3)}function M(t){const e=parseInt(t);return 2*(e>=0?e-1:e+s.length/2)}function g(t,e,a){r.push([i[t],i[t+1],i[t+2]]),r.push([i[e],i[e+1],i[e+2]]),r.push([i[a],i[a+1],i[a+2]]),l.push(3*u+0),l.push(3*u+1),l.push(3*u+2),u++}function w(t,e,r){a.push([s[t],s[t+1]]),a.push([s[e],s[e+1]]),a.push([s[r],s[r+1]])}function y(t,e,r){n.push([o[t],o[t+1],o[t+2]]),n.push([o[e],o[e+1],o[e+2]]),n.push([o[r],o[r+1],o[r+2]])}function z(t,e,r,a,n,i,o,s,l,h,u,c){let x,d=b(t),f=b(e),m=b(r);void 0===a?g(d,f,m):(g(d,f,x=b(a)),g(f,m,x)),void 0!==n&&(d=M(n),f=M(i),m=M(o),void 0===a?w(d,f,m):(w(d,f,x=M(s)),w(f,m,x))),void 0!==l&&(d=F(l),f=F(h),m=F(u),void 0===a?y(d,f,m):(y(d,f,x=F(c)),y(f,m,x)))}for(let t=0;t<e.length;t++){let r=e[t];0!==(r=r.trim()).length&&"#"!==r.charAt(0)&&(null!==(h=c.exec(r))?i.push(parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3])):null!==(h=x.exec(r))?o.push(parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3])):null!==(h=d.exec(r))?s.push(parseFloat(h[1]),parseFloat(h[2])):null!==(h=f.exec(r))?z(h[1],h[2],h[3],h[4]):null!==(h=m.exec(r))?z(h[2],h[5],h[8],h[11],h[3],h[6],h[9],h[12]):null!==(h=p.exec(r))?z(h[2],h[6],h[10],h[14],h[3],h[7],h[11],h[15],h[4],h[8],h[12],h[16]):null!==(h=v.exec(r))&&z(h[2],h[5],h[8],h[11],void 0,void 0,void 0,void 0,h[3],h[6],h[9],h[12]))}return{positions:r,coords:a,normals:n,indices:l}}}var q=Y;function k(t,e){this.gl=t,this.format=e,void 0!==this.format.type&&null!==this.format.type||(this.format.type=t.TEXTURE_2D)}k.prototype={_checkData(){null!==this.format.data&&void 0!==this.format.data?this.format.data instanceof Image&&this.loadImage(this.format.data):this.loadBlankTexture()},bind(t=0){let e=this.gl;return e.activeTexture(e[`TEXTURE${t}`]),e.bindTexture(this.format.type,this),this},unbind(){return this.gl.bindTexture(this.format.type,null),this},createDepthTexture(t){let e=this.gl;return e.bindTexture(this.format.type,this),e.texParameteri(this.format.type,e.TEXTURE_MAG_FILTER,t.magFilter),e.texParameteri(this.format.type,e.TEXTURE_MIN_FILTER,t.minFilter),e.texParameteri(this.format.type,e.TEXTURE_WRAP_S,t.wrapS),e.texParameteri(this.format.type,e.TEXTURE_WRAP_T,t.wrapT),e instanceof WebGLRenderingContext?e.texImage2D(this.format.type,0,t.depthType,t.width,t.height,0,t.depthType,e.UNSIGNED_SHORT,null):e.texImage2D(this.format.type,0,t.depthType,t.width,t.height,0,e.DEPTH_COMPONENT,e.UNSIGNED_SHORT,null),e.bindTexture(this.format.type,null),this},loadBlankTexture(){return this.loadData(null),this},loadData(t){let e=this.gl,r=this.format;return e.bindTexture(this.format.type,this),e.texImage2D(this.format.type,0,r.internalFormat,r.width,r.height,0,r.format,r.texelType,t),e.texParameteri(this.format.type,e.TEXTURE_MAG_FILTER,r.magFilter),e.texParameteri(this.format.type,e.TEXTURE_MIN_FILTER,r.minFilter),e.texParameteri(this.format.type,e.TEXTURE_WRAP_S,r.wrapS),e.texParameteri(this.format.type,e.TEXTURE_WRAP_T,r.wrapT),r.generateMipMaps&&e.generateMipmap(this.format.type),e.bindTexture(this.format.type,null),this},loadImage(t){let e=this.gl,r=this.format;return this.format.width=t.width,this.format.height=t.height,e.bindTexture(this.format.type,this),this.format.flipY&&e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r.flipY),e.texImage2D(this.format.target,this.format.level,this.format.internalFormat,t.width,t.height,0,this.format.format,this.format.texelType,t),e.texParameteri(this.format.type,e.TEXTURE_MAG_FILTER,r.magFilter),e.texParameteri(this.format.type,e.TEXTURE_MIN_FILTER,r.minFilter),e.texParameteri(this.format.type,e.TEXTURE_WRAP_S,r.wrapS),e.texParameteri(this.format.type,e.TEXTURE_WRAP_T,r.wrapT),r.generateMipMaps&&e.generateMipmap(this.format.type),e.bindTexture(this.format.type,null),this},resize(t,e){let r=this.gl,a=this.format;return this.format.width=t,this.format.height=e,this.bind(),r.texImage2D(this.format.type,0,a.internalFormat,this.format.width,this.format.height,0,a.format,a.texelType,this.contents),this}};const X=function(t={canvas:document.createElement("canvas"),width:window.innerWidth,height:window.innerHeight,glOptions:{alpha:!0,antialias:!0,depth:!0}}){let e=t.canvas.getContext("webgl2",t.glOptions);for(let t in a.prototype)e[t]=a.prototype[t];return Object.assign(e,new a(t.width,t.height)),e}().setFullscreen();document.body.appendChild(X.canvas);let G=null;const H=new class extends d{constructor({fov:t=Math.PI/4,aspect:e=window.innerWidth/window.innerHeight,near:r=.1,far:a=1e3}={}){return super(),this.projectionMatrix=u.create(),this.viewMatrix=u.create(),this.fov=t,this.aspect=e,this.near=r,this.far=a,u.perspective(this.projectionMatrix,t,e,r,a),this}resize(t){this.aspect=t,u.perspective(this.projectionMatrix,this.fov,this.aspect,this.near,this.far)}}({near:.1,far:1e4,aspect:X.canvas.width/X.canvas.height});H.setZoom(-20);let W=null,Z=new Image;function $(){requestAnimationFrame($),X.clearScreen(),W.bind(0),G.draw(H)}Z.src="/assets/thumb.jpg",fetch("assets/petal.txt").then(t=>t.text()).then(t=>{let e=q.parse(t);G=new U(X,e,[window.innerWidth,window.innerHeight],5e3),Z.onload=(()=>{W=function(t,e=new z(t)){let r=t.createTexture();for(let t in k.prototype)r[t]=k.prototype[t];let a=new k(t,e);return Object.assign(r,a),r._checkData(),r}(X,new z(X,{data:Z})),$()})})}]);
//# sourceMappingURL=app.main.min.js.map